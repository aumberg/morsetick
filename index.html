<!DOCTYPE html>
<html>
<head>
	<title>morsetick - ...</title>
	<script type="text/javascript" src="morsetick.js"></script>
	<script type="text/javascript">
		var appName = "morsetick";
		var app = window[appName];
		$ = app.$;

		$(function () {
			var input = $("#script_url")
			var scriptUrl = location.href.match(/.*\//)[0] + "morsetick.js";
			var storedUrl = (localStorage["morsetick script url"] || scriptUrl);
			var rq = {
				dataType: "script",
				crossDomain: true,
				success: function () {
					afterLoadApp()
					localStorage["morsetick script url"] = rq.url;
					input.parent().css("background-color", "");
				},
				error: function () {
					input.parent().css("background-color", "red");
				}
			}
			var afterLoadApp = function() {
				var url = "javascript:(function(){var script=document.createElement('script');script.src='" + input.val() + "#'+(new Date().getTime());document.body.appendChild(script);}())";

				app = window[appName];
				$ = app.$;

				$("#option_program_description").text(app["option program description"]);
				$("#option_program_name").text(app["option program name"])
				$("#option_program_bookmark").attr("href", url);
				$("#option_program_version").text(app["option program version"]);
				$("#option_program_source_code")
					.attr("href", app["option program source code"])
					.text("(source code)");
			}

			input.val(storedUrl).change(function() {
				rq.url = input.val().match(/^\s*$/) ? input.val(scriptUrl).val() : input.val();
				$.ajax(rq);
			})

			if (scriptUrl !== storedUrl) {
				rq.url = storedUrl;

				if (storedUrl.match(/^\s*$/)) {
					rq.url = scriptUrl;

					return;
				}

				$.ajax(rq);
			}

			$(window)
				.on("keyup", function(event) {
					setTimeout(function() {
						$("#morse_code").text(morsetick["memory input message"]);
						$("#latin_text").text(morsetick["library morse"]($.trim(morsetick["memory input message"])));

						$("#memory_dot_duration").text(morsetick["memory dot duration"]);
					}, 50);
				});

			$(window).not("textarea, input")
				.on("tap", function() {
				    var e = $.Event(lastAction = ("keyup" === lastAction) ? "keydown" : 'keyup');
				    e.which = 17; // 'control' key
				    $(window).trigger(e);
				})
				.on("mousedown", function() {
				    var e = $.Event('keydown');
				    e.which = 17; // 'control' key
				    $(window).trigger(e);
				})
				.on("mouseup", function() {
				    var e = $.Event('keyup');
				    e.which = 17; // 'control' key
				    $(window).trigger(e);
				});

			afterLoadApp();
			setInterval(afterLoadApp, 5000);
		})
	</script>
</head>
<body style="height:2000px; background-color:#DDD;">
	<div>
		<h3>
			<div style="text-align:center;">
				<br/>
				<br/>
				<a id="option_program_bookmark" href="">
					<span id="option_program_name"></span>
				</a>
				- <span id="option_program_description"></span>
				<br/>
				<br/>
				version <span id="option_program_version"> - program not loaded</span>
				<a id="option_program_source_code" href="" target="_blank"></a>
			</div>
		</h3>
	</div>
	<ul>
		<li>
			<p>
				script utl:
			</p>
			<ol>
				<li>
					<input id="script_url" size="100px" type="url">
				</li>
			</ol>
		</li>
		<li>
			<p>
				get started:
			</p>
			<ol>
				<li>
					Just press "control" key, or click on page
				</li>
				<li>
					Try to type 
				</li>
				<li>
					For add links on sound files, download and change source code, then open <b>index.html</b> on local device
				</li>
			</ol>
		</li>
		<li>
			<p>
				morse code (dot duration - <span id="memory_dot_duration"></span>):
			</p>
			<ol>
				<li>
					<textarea id="latin_text" readonly="readonly" cols="50" rows="1" style="font-size:30px;"></textarea>
				</li>
				<li>
					<textarea id="morse_code" readonly="readonly" cols="50" rows="1" style="font-size:30px;"></textarea>
				</li>
			</ol>
		</li>
	</ul>
</body>
</html>